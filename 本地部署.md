# 本地部署指南

本文档详细介绍了如何在本地构建 `easy-dataset` 的完全独立运行环境。提供了两种主要方式：推荐使用 **Docker** 进行隔离部署，也可以选择 **源码直接部署**。

## 前置准备

在开始之前，请确保您的系统满足以下要求：

- **操作系统**: macOS, Windows, 或 Linux
- **硬件资源**: 建议 4GB RAM 以上

## 方式一：Docker 部署（推荐）

Docker 部署可以构建一个完全独立、与宿主机环境隔离的运行环境，不会污染本地的 Node.js 版本或全局依赖。

### 1. 安装 Docker

如果您尚未安装 Docker，请前往 [Docker 官网](https://www.docker.com/products/docker-desktop/) 下载并安装 Docker Desktop。

### 2. 获取代码与构建镜像

在项目根目录下，执行以下命令构建 Docker 镜像：

```bash
# 构建镜像 (名称可自定义，这里使用 easy-dataset)
docker build -t easy-dataset .
```

*注意：构建过程可能需要几分钟，取决于网络状况。*

### 3. 启动服务

使用 Docker Compose 启动服务，可以确保数据持久化（数据库和上传文件不丢失）。

```bash
# 后台启动服务
docker-compose up -d
```

### 4. 访问应用

服务启动后的访问地址：
- **Web 界面**: http://localhost:1717

### 5. 数据管理

在 Docker 部署模式下，数据存储在项目根目录下的挂载卷中：
- Database: `./local-db`
- Prisma Schema: `./prisma`

### 常用 Docker 命令

- **停止服务**: `docker-compose down`
- **查看日志**: `docker-compose logs -f`
- **重启服务**: `docker-compose restart`
- **重新构建**: `docker-compose up -d --build`

---

## 方式二：源码直接部署

如果您希望在本地开发或调试代码，可以使用源码部署。

### 1. 环境依赖

请确保安装了以下工具：
- **Node.js**: 推荐 v18 或 v20 (可使用 `nvm` 管理)
- **pnpm**: 包管理工具 (`npm install -g pnpm`)

### 2. 安装依赖

在项目根目录下运行：

```bash
pnpm install
```

### 3. 初始化数据库

项目使用 SQLite 作为数据库，无需额外安装数据库软件。

```bash
# 推送数据库结构
pnpm db:push
```

### 4. 启动开发服务

```bash
pnpm dev
```

启动后访问 http://localhost:1717 即可。

### 5. 构建生产版本

如果要以生产模式运行：

```bash
pnpm build
pnpm start
```

---

## 常见问题处理 (Troubleshooting)

### 1. 端口冲突 (1717 Port in use)

如果启动时提示端口 1717 被占用：
- **Docker**: 修改 `docker-compose.yml` 中的端口映射，例如 `'1718:1717'`，然后访问 localhost:1718。
- **源码**: 修改 `package.json` 中的 script，将 `-p 1717` 改为其他端口。

### 2. 数据库错误

如果遇到数据库相关错误，尝试重置数据库（注意备份）：
```bash
rm -rf local-db
pnpm db:push
```

### 3. 依赖安装慢

可以配置 pnpm 使用国内镜像源：
```bash
pnpm config set registry https://registry.npmmirror.com/
```
